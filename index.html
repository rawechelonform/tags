<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>tag the wall</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: system-ui, sans-serif; margin: 24px; text-transform: none }
    .status { margin-top: 12px; font-size: 14px }
    .status.ok { color: #107010 }
    .status.err { color: #b00020 }
    .hidden { display: none }
    label { display: block; margin: 8px 0 4px }
    input[type="text"] { width: 280px; max-width: 100% }
    button { margin-top: 12px }
  </style>
</head>
<body>
  <h1>tag the wall</h1>

  <!-- Hidden iframe target so the page doesn't navigate on submit -->
  <iframe name="upload_iframe" id="upload_iframe" class="hidden"></iframe>

  <form id="tag-form" method="POST" enctype="multipart/form-data" target="upload_iframe">
    <label>image</label>
    <input type="file" id="sticker" name="sticker" accept="image/*" required>

    <label>place of tag</label>
    <input type="text" name="title" placeholder="eg: metro_station">

    <label>city</label>
    <input type="text" name="city" placeholder="eg: budapest">

    <label>country</label>
    <input type="text" name="country" placeholder="eg: hu">

    <div class="status" id="status"></div>
    <button type="submit">submit</button>
  </form>

  <script>
    // paste your deployed GAS Web App URL (must end with /exec)
    const UPLOAD_ENDPOINT = 'PASTE_YOUR_WEB_APP_EXEC_URL_HERE';

    const form = document.getElementById('tag-form');
    const statusEl = document.getElementById('status');
    const fileInput = document.getElementById('sticker');

    // set the action dynamically so you only change it in one place
    form.action = UPLOAD_ENDPOINT;

    form.addEventListener('submit', (e) => {
      status('');
      const f = fileInput.files[0];
      if (!f) {
        e.preventDefault();
        status('no image uploaded', true);
        return;
      }
      if (f.size > 10 * 1024 * 1024) {
        e.preventDefault();
        status('file size limit: 10mb', true);
        return;
      }
      status('uploading…');
    });

    window.addEventListener('message', (event) => {
      // Accept replies from Google’s web app origins
      const okOrigin = event.origin === 'https://script.google.com' ||
                       event.origin === 'https://script.googleusercontent.com';
      if (!okOrigin) return;

      const data = event.data || {};
      if (data.source !== 'tags-webapp') return;

      if (data.ok) {
        status('tag submitted. it may take a few days to see tag added to the wall.', false, true);
        form.reset();
      } else {
        status(data.error || 'upload failed', true);
        console.debug('debug:', data.debug);
      }
    });

    function status(msg, isErr = false, isOk = false) {
      statusEl.textContent = msg;
      statusEl.classList.toggle('err', !!isErr);
      statusEl.classList.toggle('ok', !!isOk);
    }
  </script>
</body>
</html>
