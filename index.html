<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>tag the wall</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
  <style>
    body{background:#000;color:#0f0;font-family:'DotGothic16',monospace;
         text-transform:uppercase;letter-spacing:.08em;font-size:20px;line-height:1.3}
    .wrap{max-width:900px;margin:56px auto;padding:0 1in}
    .q{margin-top:18px}
    .line{display:flex;align-items:baseline;gap:1ch;margin-top:12px}
    .caret{flex:0 0 auto}
    .typed{flex:1 1 auto;white-space:pre-wrap;min-height:1.3em}
    .typed.ph{color:rgba(0,255,0,.55)}
    .cursor-block{display:inline-block;width:1.1ch;height:1em;background:#0f0;
                  animation:blink .8s steps(1,end) infinite}
    @keyframes blink{50%{background:transparent}}
    .hid-input{position:absolute;left:-9999px;width:1px;height:1px;opacity:0}
    .btn{padding:10px 14px;border:1px solid #0f0;background:#000;color:#0f0;font-weight:700;cursor:pointer}
    input[type=file]{display:none}
    .file-status{margin-left:12px;font-style:italic;color:rgba(0,255,0,.55)}
    .status{margin-left:14px;font-style:italic}
    .banner{margin-left:14px;font-style:italic}
    .banner.error{color:#f66;text-transform:none}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>tag the wall <span id="banner" class="banner"></span></h1>

    <form id="tags_form"
  action="https://script.google.com/macros/s/AKfycbxv3FKB0P30wixxKJUfYvTnCW9vzqgar4JV7PArIpirC9lk7Srpqe3SNDKIcCIvjs_4/exec"
  method="POST" enctype="multipart/form-data" novalidate>

      <div class="q">upload image</div>
      <div class="line">
        <span class="caret">></span>
        <label for="sticker" class="btn">upload image</label>
        <input id="sticker" type="file" name="sticker" accept=".png,.jpg,.jpeg,.webp" required>
        <span id="fileStatus" class="file-status"></span>
      </div>

      <div class="q">place of tag</div>
      <div class="line" data-field="title" data-ph="coffeeshop, berlin wall">
        <span class="caret">></span>
        <div class="typed" id="typed-title"></div>
        <input id="hid-title" class="hid-input" name="title" maxlength="30">
      </div>

      <div class="q">city</div>
      <div class="line" data-field="city" data-ph="new york city">
        <span class="caret">></span>
        <div class="typed" id="typed-city"></div>
        <input id="hid-city" class="hid-input" name="city" maxlength="30">
      </div>

      <div class="q">country</div>
      <div class="line" data-field="country" data-ph="usa">
        <span class="caret">></span>
        <div class="typed" id="typed-country"></div>
        <input id="hid-country" class="hid-input" name="country" maxlength="30">
      </div>

      <input class="hid-input" type="text" name="website"> <!-- honeypot -->

      <div class="line">
        <span class="caret">></span>
        <button id="submitBtn" class="btn">go</button>
        <span id="status" class="status"></span>
      </div>
    </form>

    <span id="cursor" class="cursor-block" style="display:none"></span>
  </div>

  <script>
    // cursor + typed placeholders
    const cursor=document.getElementById('cursor');
    function attachCursorTo(t){t&&t.appendChild(cursor);cursor.style.display=''}
    function hideCursor(){cursor.style.display='none';document.body.appendChild(cursor)}
    function bindField(f){
      const line=document.querySelector('.line[data-field="'+f+'"]');
      if(!line)return;
      const typed=line.querySelector('.typed');
      const input=document.getElementById('hid-'+f);
      const ph=line.getAttribute('data-ph')||'';
      line.addEventListener('click',()=>input.focus());
      function render(showPh=true){
        const v=input.value||'';
        if(!v&&showPh){typed.textContent=ph;typed.classList.add('ph')}
        else{typed.textContent=v.toUpperCase();typed.classList.remove('ph')}
      }
      input.addEventListener('focus',()=>{render(false);attachCursorTo(typed)});
      input.addEventListener('input',()=>{input.value=input.value.toLowerCase().slice(0,30);render(false);attachCursorTo(typed)});
      input.addEventListener('blur',()=>{hideCursor();if(!input.value)render(true)});
      render(true);
    }
    ['title','city','country'].forEach(bindField);

    // file display + validation
    const form=document.getElementById('tags_form');
    const fileInput=document.getElementById('sticker');
    const fileStatus=document.getElementById('fileStatus');
    const status=document.getElementById('status');
    fileInput.addEventListener('change',()=>{
      const f=fileInput.files[0];
      fileStatus.textContent=f?`selected: ${f.name} (${(f.size/1024).toFixed(1)} KB)`:''});
    form.addEventListener('submit',e=>{
      const f=fileInput.files[0];
      if(!f){e.preventDefault();status.textContent='no image uploaded';return}
      if(!['image/png','image/jpeg','image/webp'].includes(f.type)){
        e.preventDefault();status.textContent='png/jpeg/webp only';return}
      if(f.size>10*1024*1024){e.preventDefault();status.textContent='max 10mb';return}
      status.textContent='uploading...';
    });

    // banner from redirect
    const p=new URLSearchParams(location.search);
    if(p.get('ok')==='1'){banner.textContent='tag submitted.'}
    if(p.get('error')==='1'){banner.textContent='upload failed'}
  </script>
</body>
</html>
